<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Store Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans Devanagari', sans-serif;
        }
        
        /* Theme Variables */
        :root {
            --primary: #3B82F6;
            --secondary: #10B981;
            --accent: #8B5CF6;
            --bg-start: #EFF6FF;
            --bg-end: #F0F9FF;
            --card: #FFFFFF;
            --text: #1F2937;
            --text-light: #6B7280;
        }
        
        /* Theme Classes */
        .theme-blue { --primary: #3B82F6; --secondary: #10B981; --accent: #8B5CF6; --bg-start: #EFF6FF; --bg-end: #F0F9FF; }
        .theme-green { --primary: #10B981; --secondary: #059669; --accent: #34D399; --bg-start: #ECFDF5; --bg-end: #F0FDF4; }
        .theme-purple { --primary: #8B5CF6; --secondary: #7C3AED; --accent: #A78BFA; --bg-start: #F5F3FF; --bg-end: #FAF5FF; }
        .theme-pink { --primary: #EC4899; --secondary: #DB2777; --accent: #F472B6; --bg-start: #FDF2F8; --bg-end: #FEF7F0; }
        .theme-orange { --primary: #F97316; --secondary: #EA580C; --accent: #FB923C; --bg-start: #FFF7ED; --bg-end: #FFFBEB; }
        .theme-red { --primary: #EF4444; --secondary: #DC2626; --accent: #F87171; --bg-start: #FEF2F2; --bg-end: #FFF5F5; }
        .theme-indigo { --primary: #6366F1; --secondary: #4F46E5; --accent: #818CF8; --bg-start: #EEF2FF; --bg-end: #F0F9FF; }
        .theme-teal { --primary: #14B8A6; --secondary: #0D9488; --accent: #5EEAD4; --bg-start: #F0FDFA; --bg-end: #CCFBF1; }
        .theme-yellow { --primary: #F59E0B; --secondary: #D97706; --accent: #FCD34D; --bg-start: #FFFBEB; --bg-end: #FEF3C7; }
        .theme-gray { --primary: #6B7280; --secondary: #4B5563; --accent: #9CA3AF; --bg-start: #F9FAFB; --bg-end: #F3F4F6; }
        .theme-cyan { --primary: #06B6D4; --secondary: #0891B2; --accent: #67E8F9; --bg-start: #ECFEFF; --bg-end: #CFFAFE; }
        .theme-dark { --primary: #374151; --secondary: #1F2937; --accent: #6B7280; --bg-start: #111827; --bg-end: #1F2937; --card: #374151; --text: #F9FAFB; --text-light: #D1D5DB; }
        
        /* Apply theme colors */
        body {
            background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
            color: var(--text);
        }
        
        .primary-bg { background-color: var(--primary) !important; }
        .secondary-bg { background-color: var(--secondary) !important; }
        .accent-bg { background-color: var(--accent) !important; }
        .card-bg { background-color: var(--card) !important; }
        .primary-text { color: var(--primary) !important; }
        .secondary-text { color: var(--secondary) !important; }
        .text-main { color: var(--text) !important; }
        .text-light { color: var(--text-light) !important; }
        
        .primary-gradient { background: linear-gradient(135deg, var(--primary), var(--secondary)) !important; }
        .accent-gradient { background: linear-gradient(135deg, var(--accent), var(--primary)) !important; }
        
        .scanner-container {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            border: 2px solid var(--secondary);
            border-radius: 16px;
            overflow: hidden;
            background: #000;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        #reader, #storeReader, #shoppingReader {
            width: 100% !important;
            border-radius: 14px;
            min-height: 250px;
        }
        
        #reader video, #storeReader video, #shoppingReader video {
            border-radius: 14px !important;
            object-fit: cover !important;
            width: 100% !important;
            height: 250px !important;
        }
        
        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
        }
        
        .scanner-overlay::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 160px;
            height: 160px;
            border: 2px solid var(--secondary);
            border-radius: 12px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { border-color: var(--secondary); }
            50% { border-color: var(--accent); }
        }
        
        .flashlight-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 20;
            width: 32px;
            height: 32px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .flashlight-btn:hover {
            background: rgba(0, 0, 0, 0.9);
        }
        
        .flashlight-btn.active {
            background: var(--secondary);
        }
        
        .modern-card {
            background: var(--card);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .modern-input {
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
            background: var(--card);
            color: var(--text);
        }
        
        .modern-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }
        
        .modern-btn {
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: none;
        }
        
        .modern-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .compact-product {
            background: var(--card);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        
        .compact-product:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        .add-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 40;
        }
        
        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        @media print {
            body * { visibility: hidden; }
            .print-area, .print-area * { visibility: visible; }
            .print-area { position: absolute; left: 0; top: 0; width: 100%; }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <!-- Header -->
    <div class="card-bg sticky top-0 z-50 border-b shadow-sm">
        <div class="px-4 py-3">
            <div class="flex items-center justify-between">
                <h1 id="storeName" class="text-xl font-bold primary-text">‡§Æ‡•á‡§∞‡§æ ‡§∏‡•ç‡§ü‡•ã‡§∞</h1>
                <div class="relative">
                    <button onclick="toggleMenu()" class="p-2 primary-gradient text-white rounded-lg modern-btn">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    
                    <!-- Menu Dropdown -->
                    <div id="menuDropdown" class="absolute right-0 top-full mt-2 w-56 card-bg rounded-xl shadow-xl border hidden z-50">
                        <div class="p-2">
                            <button onclick="editStoreName()" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded-lg flex items-center space-x-2 text-sm">
                                <span class="text-lg">üè™</span>
                                <span class="text-main">‡§∏‡•ç‡§ü‡•ã‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡§¶‡§≤‡•á‡§Ç</span>
                            </button>
                            <button onclick="showThemeSelector()" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded-lg flex items-center space-x-2 text-sm">
                                <span class="text-lg">üé®</span>
                                <span class="text-main">‡§•‡•Ä‡§Æ ‡§¨‡§¶‡§≤‡•á‡§Ç</span>
                            </button>
                            <button onclick="showNotesModal()" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded-lg flex items-center space-x-2 text-sm">
                                <span class="text-lg">üìù</span>
                                <span class="text-main">‡§®‡•ã‡§ü‡•ç‡§∏</span>
                            </button>
                            <hr class="my-2">
                            <button onclick="exportData()" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded-lg flex items-center space-x-2 text-sm">
                                <span class="text-lg">üì§</span>
                                <span class="text-main">‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</span>
                            </button>
                            <button onclick="document.getElementById('importFile').click()" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded-lg flex items-center space-x-2 text-sm">
                                <span class="text-lg">üì•</span>
                                <span class="text-main">‡§°‡•á‡§ü‡§æ ‡§á‡§Æ‡•ç‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">

    <!-- Navigation -->
    <div class="card-bg border-b shadow-sm">
        <div class="flex">
            <button onclick="showSection('store')" id="storeTab" class="flex-1 py-3 px-3 text-center font-semibold primary-text border-b-2 primary-bg text-white">
                üè™ ‡§∏‡•ç‡§ü‡•ã‡§∞
            </button>
            <button onclick="showSection('shopping')" id="shoppingTab" class="flex-1 py-3 px-3 text-center font-semibold text-light hover:bg-gray-50">
                üõí ‡§∂‡•â‡§™‡§ø‡§Ç‡§ó
            </button>
            <button onclick="showSection('history')" id="historyTab" class="flex-1 py-3 px-3 text-center font-semibold text-light hover:bg-gray-50">
                üìã ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä
            </button>
        </div>
    </div>

    <!-- Store Section -->
    <div id="storeSection" class="p-3 pb-20">
        <!-- Add Product Modal -->
        <div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
            <div class="modern-card p-4 w-full max-w-md slide-up">
                <h3 class="text-lg font-bold mb-3 text-main">‚ú® ‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
                
                <div class="mb-4">
                    <button onclick="startScanning('store')" id="storeScanBtn" class="w-full primary-gradient text-white py-2 px-3 rounded-lg font-semibold modern-btn mb-2 text-sm">
                        üì± ‡§¨‡§æ‡§∞‡§ï‡•ã‡§° ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç
                    </button>
                    <div id="storeScanner" class="scanner-container hidden mb-3">
                        <div id="storeReader" class="relative">
                            <div class="scanner-overlay"></div>
                            <button onclick="toggleFlashlight('store')" id="storeFlashBtn" class="flashlight-btn">üí°</button>
                        </div>
                        <button onclick="stopScanning('store')" class="w-full bg-red-500 text-white py-2 px-3 rounded-lg font-semibold modern-btn mt-2 text-sm">
                            ‚ùå ‡§∏‡•ç‡§ï‡•à‡§® ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç
                        </button>
                    </div>
                </div>

                <div class="space-y-3">
                    <input type="text" id="productBarcode" placeholder="üî¢ ‡§¨‡§æ‡§∞‡§ï‡•ã‡§°" class="w-full p-3 modern-input text-sm" onchange="fetchProductDetails(this.value)">
                    <input type="text" id="productName" placeholder="üì¶ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ" class="w-full p-3 modern-input text-sm" required>
                    <input type="number" id="productPrice" placeholder="üí∞ ‡§ï‡•Ä‡§Æ‡§§ (‚Çπ)" class="w-full p-3 modern-input text-sm" required>
                    <textarea id="productDetails" placeholder="üìù ‡§µ‡§ø‡§µ‡§∞‡§£" class="w-full p-3 modern-input h-16 resize-none text-sm"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-2 mt-4">
                    <button onclick="addProduct()" class="secondary-bg text-white py-2 px-3 rounded-lg font-semibold modern-btn text-sm">
                        ‚ûï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                    </button>
                    <button onclick="closeAddModal()" class="bg-gray-500 text-white py-2 px-3 rounded-lg font-semibold modern-btn text-sm">
                        ‚ùå ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç
                    </button>
                </div>
            </div>
        </div>

        <!-- Products List -->
        <div class="modern-card p-4">
            <h2 class="text-lg font-bold mb-3 text-main">üì¶ ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü‡•ç‡§∏</h2>
            <div id="productsList" class="space-y-2">
                <!-- Products will be displayed here -->
            </div>
        </div>

        <!-- Floating Add Button -->
        <button onclick="showAddModal()" class="add-btn">+</button>
    </div>

    <!-- Shopping Section -->
    <div id="shoppingSection" class="p-3 pb-20 hidden">
        <!-- Top Action Buttons -->
        <div class="grid grid-cols-3 gap-2 mb-3">
            <button onclick="saveBill()" class="secondary-bg text-white py-2 px-2 rounded-lg font-semibold modern-btn text-sm">
                üíæ ‡§∏‡•á‡§µ
            </button>
            <button onclick="printBill()" class="primary-bg text-white py-2 px-2 rounded-lg font-semibold modern-btn text-sm">
                üñ®Ô∏è ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü
            </button>
            <button onclick="clearBill()" class="bg-red-500 text-white py-2 px-2 rounded-lg font-semibold modern-btn text-sm">
                üóëÔ∏è ‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞
            </button>
        </div>

        <!-- Bill Section -->
        <div class="modern-card p-4 mb-3">
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-bold text-main">üõçÔ∏è ‡§¨‡§ø‡§≤</h3>
                <button onclick="startScanning('shopping')" id="shoppingScanBtn" class="primary-gradient text-white py-1 px-3 rounded-lg font-semibold modern-btn text-sm">
                    + ‡§∏‡•ç‡§ï‡•à‡§®
                </button>
            </div>
            
            <div id="shoppingScanner" class="scanner-container hidden mb-3">
                <div id="shoppingReader" class="relative">
                    <div class="scanner-overlay"></div>
                    <button onclick="toggleFlashlight('shopping')" id="shoppingFlashBtn" class="flashlight-btn">üí°</button>
                </div>
                <button onclick="stopScanning('shopping')" class="w-full bg-red-500 text-white py-2 px-3 rounded-lg font-semibold modern-btn mt-2 text-sm">
                    ‚ùå ‡§∏‡•ç‡§ï‡•à‡§® ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç
                </button>
            </div>

            <input type="text" id="customerName" placeholder="üë§ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)" class="w-full p-3 modern-input mb-3 text-sm">
            <input type="text" id="searchProduct" placeholder="üîç ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§ñ‡•ã‡§ú‡•á‡§Ç" class="w-full p-3 modern-input mb-3 text-sm" onkeyup="searchProducts(this.value)">
            
            <div id="searchResults" class="hidden mb-3 space-y-2">
                <!-- Search results will appear here -->
            </div>

            <div id="billItems" class="space-y-2 mb-4">
                <!-- Bill items will be displayed here -->
            </div>
            
            <div class="border-t pt-3">
                <div class="flex justify-between items-center text-xl font-bold secondary-text">
                    <span>‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</span>
                    <span id="totalAmount">‚Çπ0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- History Section -->
    <div id="historySection" class="p-3 hidden">
        <div class="modern-card p-4">
            <h2 class="text-lg font-bold mb-3 text-main">üìã ‡§¨‡§ø‡§≤ ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä</h2>
            <div id="billHistory" class="space-y-3">
                <!-- Bill history will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Print Area (Hidden) -->
    <div class="print-area hidden">
        <div id="printContent"></div>
    </div>

    <!-- Edit Product Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="modern-card p-4 w-full max-w-md slide-up">
            <h3 class="text-lg font-bold mb-3 text-main">‚úèÔ∏è ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç</h3>
            <div class="space-y-3">
                <input type="text" id="editProductName" placeholder="üì¶ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ" class="w-full p-3 modern-input text-sm">
                <input type="number" id="editProductPrice" placeholder="üí∞ ‡§ï‡•Ä‡§Æ‡§§ (‚Çπ)" class="w-full p-3 modern-input text-sm">
                <textarea id="editProductDetails" placeholder="üìù ‡§µ‡§ø‡§µ‡§∞‡§£" class="w-full p-3 modern-input h-16 resize-none text-sm"></textarea>
            </div>
            <div class="grid grid-cols-2 gap-2 mt-4">
                <button onclick="updateProduct()" class="secondary-bg text-white py-2 px-3 rounded-lg font-semibold modern-btn text-sm">
                    ‚úÖ ‡§Ö‡§™‡§°‡•á‡§ü
                </button>
                <button onclick="closeEditModal()" class="bg-gray-500 text-white py-2 px-3 rounded-lg font-semibold modern-btn text-sm">
                    ‚ùå ‡§ï‡•à‡§Ç‡§∏‡§≤
                </button>
            </div>
        </div>
    </div>

    <!-- Theme Selector Modal -->
    <div id="themeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="modern-card p-4 w-full max-w-lg slide-up">
            <h3 class="text-lg font-bold mb-3 text-main">üé® ‡§•‡•Ä‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç</h3>
            <div class="grid grid-cols-3 gap-2 mb-4">
                <button onclick="changeTheme('blue')" class="p-3 rounded-lg border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 hover:border-blue-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-blue-500 to-indigo-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§®‡•Ä‡§≤‡§æ</span>
                </button>
                <button onclick="changeTheme('green')" class="p-3 rounded-lg border-2 border-green-200 bg-gradient-to-br from-green-50 to-green-100 hover:border-green-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-green-500 to-emerald-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§π‡§∞‡§æ</span>
                </button>
                <button onclick="changeTheme('purple')" class="p-3 rounded-lg border-2 border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 hover:border-purple-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-purple-500 to-violet-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§¨‡•à‡§Ç‡§ó‡§®‡•Ä</span>
                </button>
                <button onclick="changeTheme('pink')" class="p-3 rounded-lg border-2 border-pink-200 bg-gradient-to-br from-pink-50 to-pink-100 hover:border-pink-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-pink-500 to-rose-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§ó‡•Å‡§≤‡§æ‡§¨‡•Ä</span>
                </button>
                <button onclick="changeTheme('orange')" class="p-3 rounded-lg border-2 border-orange-200 bg-gradient-to-br from-orange-50 to-orange-100 hover:border-orange-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-orange-500 to-amber-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§®‡§æ‡§∞‡§Ç‡§ó‡•Ä</span>
                </button>
                <button onclick="changeTheme('red')" class="p-3 rounded-lg border-2 border-red-200 bg-gradient-to-br from-red-50 to-red-100 hover:border-red-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-red-500 to-pink-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§≤‡§æ‡§≤</span>
                </button>
                <button onclick="changeTheme('indigo')" class="p-3 rounded-lg border-2 border-indigo-200 bg-gradient-to-br from-indigo-50 to-indigo-100 hover:border-indigo-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-indigo-500 to-blue-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§á‡§Ç‡§°‡§ø‡§ó‡•ã</span>
                </button>
                <button onclick="changeTheme('teal')" class="p-3 rounded-lg border-2 border-teal-200 bg-gradient-to-br from-teal-50 to-teal-100 hover:border-teal-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-teal-500 to-cyan-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§ü‡•Ä‡§≤</span>
                </button>
                <button onclick="changeTheme('yellow')" class="p-3 rounded-lg border-2 border-yellow-200 bg-gradient-to-br from-yellow-50 to-yellow-100 hover:border-yellow-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-yellow-500 to-orange-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§™‡•Ä‡§≤‡§æ</span>
                </button>
                <button onclick="changeTheme('gray')" class="p-3 rounded-lg border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-gray-100 hover:border-gray-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-gray-500 to-slate-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§∏‡•ç‡§≤‡•á‡§ü</span>
                </button>
                <button onclick="changeTheme('cyan')" class="p-3 rounded-lg border-2 border-cyan-200 bg-gradient-to-br from-cyan-50 to-cyan-100 hover:border-cyan-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-cyan-500 to-blue-500 rounded mb-1"></div>
                    <span class="text-xs font-medium">‡§∏‡§ø‡§Ø‡§æ‡§®</span>
                </button>
                <button onclick="changeTheme('dark')" class="p-3 rounded-lg border-2 border-gray-600 bg-gradient-to-br from-gray-800 to-gray-900 hover:border-gray-400 transition-all">
                    <div class="w-full h-6 bg-gradient-to-r from-gray-700 to-gray-900 rounded mb-1"></div>
                    <span class="text-xs font-medium text-white">‡§°‡§æ‡§∞‡•ç‡§ï</span>
                </button>
            </div>
            <button onclick="closeThemeModal()" class="w-full bg-gray-500 text-white py-2 px-3 rounded-lg font-semibold modern-btn text-sm">
                ‚ùå ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç
            </button>
        </div>
    </div>

    <!-- Notes Modal -->
    <div id="notesModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="modern-card p-4 w-full max-w-md slide-up">
            <h3 class="text-lg font-bold mb-3 text-main">üìù ‡§®‡•ã‡§ü‡•ç‡§∏</h3>
            <textarea id="notesText" placeholder="‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡•á ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§≤‡§ø‡§ñ‡•á‡§Ç..." class="w-full p-3 modern-input h-32 resize-none mb-3 text-sm"></textarea>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="saveNotes()" class="secondary-bg text-white py-2 px-3 rounded-lg font-semibold modern-btn text-sm">
                    üíæ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç
                </button>
                <button onclick="closeNotesModal()" class="bg-gray-500 text-white py-2 px-3 rounded-lg font-semibold modern-btn text-sm">
                    ‚ùå ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let products = JSON.parse(localStorage.getItem('products')) || {};
        let billItems = [];
        let billHistory = JSON.parse(localStorage.getItem('billHistory')) || [];
        let storeName = localStorage.getItem('storeName') || '‡§Æ‡•á‡§∞‡§æ ‡§∏‡•ç‡§ü‡•ã‡§∞';
        let currentEditingProduct = null;
        let html5QrCode = null;
        let isScanning = false;
        let currentTheme = localStorage.getItem('currentTheme') || 'blue';
        let notes = localStorage.getItem('notes') || '';

        // Sample product database for auto-fill
        const productDatabase = {
            '8901030895566': { name: '‡§Æ‡•à‡§ó‡•Ä ‡§®‡•Ç‡§°‡§≤‡•ç‡§∏', price: 12, details: '2 ‡§Æ‡§ø‡§®‡§ü ‡§®‡•Ç‡§°‡§≤‡•ç‡§∏' },
            '8901030895573': { name: '‡§≤‡•á‡§ú ‡§ö‡§ø‡§™‡•ç‡§∏', price: 20, details: '‡§Ü‡§≤‡•Ç ‡§ï‡•á ‡§ö‡§ø‡§™‡•ç‡§∏' },
            '8901030895580': { name: '‡§ï‡•ã‡§ï‡§æ ‡§ï‡•ã‡§≤‡§æ', price: 40, details: '600ml ‡§¨‡•ã‡§§‡§≤' },
            '8901030895597': { name: '‡§¨‡•ç‡§∞‡§ø‡§ü‡§æ‡§®‡§ø‡§Ø‡§æ ‡§¨‡§ø‡§∏‡•ç‡§ï‡•Å‡§ü', price: 15, details: '‡§Æ‡•à‡§∞‡•Ä ‡§ó‡•ã‡§≤‡•ç‡§°' },
            '8901030895603': { name: '‡§Ö‡§Æ‡•Ç‡§≤ ‡§Æ‡§ø‡§≤‡•ç‡§ï', price: 25, details: '500ml ‡§™‡•à‡§ï‡•á‡§ü' },
            '8901030895610': { name: '‡§∏‡§®‡§´‡•Ä‡§∏‡•ç‡§ü ‡§ë‡§Ø‡§≤', price: 120, details: '1 ‡§≤‡•Ä‡§ü‡§∞ ‡§¨‡•ã‡§§‡§≤' },
            '8901030895627': { name: '‡§ü‡§æ‡§ü‡§æ ‡§®‡§Æ‡§ï', price: 18, details: '1 ‡§ï‡§ø‡§≤‡•ã ‡§™‡•à‡§ï‡•á‡§ü' },
            '8901030895634': { name: '‡§∏‡§∞‡•ç‡§´ ‡§è‡§ï‡•ç‡§∏‡•á‡§≤', price: 35, details: '‡§°‡§ø‡§ü‡§∞‡•ç‡§ú‡•á‡§Ç‡§ü ‡§™‡§æ‡§â‡§°‡§∞' }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('storeName').textContent = storeName;
            applyTheme(currentTheme);
            displayProducts();
            displayBillHistory();
            autoSave();
            
            // Close menu when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#menuDropdown') && !e.target.closest('button[onclick="toggleMenu()"]')) {
                    document.getElementById('menuDropdown').classList.add('hidden');
                }
            });
        });

        // Apply theme function
        function applyTheme(theme) {
            document.body.className = `min-h-screen theme-${theme}`;
            currentTheme = theme;
        }

        // Show/hide add product modal
        function showAddModal() {
            document.getElementById('addProductModal').classList.remove('hidden');
        }

        function closeAddModal() {
            document.getElementById('addProductModal').classList.add('hidden');
            // Clear form
            document.getElementById('productBarcode').value = '';
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productDetails').value = '';
        }

        // Flashlight toggle
        let flashlightEnabled = false;
        let currentStream = null;

        function toggleFlashlight(section) {
            const flashBtn = document.getElementById(section + 'FlashBtn');
            
            if (currentStream && currentStream.getVideoTracks().length > 0) {
                const track = currentStream.getVideoTracks()[0];
                const capabilities = track.getCapabilities();
                
                if (capabilities.torch) {
                    flashlightEnabled = !flashlightEnabled;
                    track.applyConstraints({
                        advanced: [{ torch: flashlightEnabled }]
                    }).then(() => {
                        flashBtn.classList.toggle('active', flashlightEnabled);
                        flashBtn.textContent = flashlightEnabled ? 'üî¶' : 'üí°';
                    }).catch(err => {
                        console.log('Torch not supported:', err);
                        showToast('‚ùå ‡§´‡•ç‡§≤‡•à‡§∂‡§≤‡§æ‡§á‡§ü ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à', 'error');
                    });
                } else {
                    showToast('‚ùå ‡§´‡•ç‡§≤‡•à‡§∂‡§≤‡§æ‡§á‡§ü ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à', 'error');
                }
            }
        }

        // Auto-save functionality
        function autoSave() {
            setInterval(() => {
                localStorage.setItem('products', JSON.stringify(products));
                localStorage.setItem('billHistory', JSON.stringify(billHistory));
                localStorage.setItem('storeName', storeName);
                localStorage.setItem('currentTheme', currentTheme);
                localStorage.setItem('notes', notes);
            }, 2000);
        }

        // Menu functions
        function toggleMenu() {
            const menu = document.getElementById('menuDropdown');
            menu.classList.toggle('hidden');
        }

        function showThemeSelector() {
            document.getElementById('menuDropdown').classList.add('hidden');
            document.getElementById('themeModal').classList.remove('hidden');
        }

        function closeThemeModal() {
            document.getElementById('themeModal').classList.add('hidden');
        }

        function changeTheme(theme) {
            applyTheme(theme);
            localStorage.setItem('currentTheme', theme);
            closeThemeModal();
            showToast('üé® ‡§•‡•Ä‡§Æ ‡§¨‡§¶‡§≤ ‡§ó‡§à!', 'success');
        }

        function showNotesModal() {
            document.getElementById('menuDropdown').classList.add('hidden');
            document.getElementById('notesText').value = notes;
            document.getElementById('notesModal').classList.remove('hidden');
        }

        function closeNotesModal() {
            document.getElementById('notesModal').classList.add('hidden');
        }

        function saveNotes() {
            notes = document.getElementById('notesText').value;
            localStorage.setItem('notes', notes);
            closeNotesModal();
            showToast('üìù ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§è!', 'success');
        }

        // Fetch product details from barcode
        function fetchProductDetails(barcode) {
            if (!barcode.trim()) return;
            
            // Check if product exists in our database
            if (productDatabase[barcode]) {
                const product = productDatabase[barcode];
                document.getElementById('productName').value = product.name;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productDetails').value = product.details;
                
                // Show success message
                showToast('‚úÖ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§ë‡§ü‡•ã-‡§´‡§ø‡§≤ ‡§π‡•ã ‡§ó‡§è!', 'success');
            } else if (products[barcode]) {
                // Check if product exists in our store
                const product = products[barcode];
                document.getElementById('productName').value = product.name;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productDetails').value = product.details || '';
                
                showToast('üì¶ ‡§∏‡•ç‡§ü‡•ã‡§∞ ‡§∏‡•á ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§è!', 'info');
            }
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            toast.className = `fixed top-20 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 fade-in`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Section navigation
        function showSection(section) {
            // Hide all sections
            document.getElementById('storeSection').classList.add('hidden');
            document.getElementById('shoppingSection').classList.add('hidden');
            document.getElementById('historySection').classList.add('hidden');
            
            // Remove active class from all tabs
            document.getElementById('storeTab').className = 'flex-1 py-4 px-4 text-center font-semibold text-gray-500 hover:text-gray-700 hover:bg-gray-50';
            document.getElementById('shoppingTab').className = 'flex-1 py-4 px-4 text-center font-semibold text-gray-500 hover:text-gray-700 hover:bg-gray-50';
            document.getElementById('historyTab').className = 'flex-1 py-4 px-4 text-center font-semibold text-gray-500 hover:text-gray-700 hover:bg-gray-50';
            
            // Show selected section
            document.getElementById(section + 'Section').classList.remove('hidden');
            document.getElementById(section + 'Section').classList.add('fade-in');
            
            // Add active class to selected tab
            const activeTab = document.getElementById(section + 'Tab');
            const icons = { store: 'üè™', shopping: 'üõí', history: 'üìã' };
            const labels = { store: '‡§∏‡•ç‡§ü‡•ã‡§∞', shopping: '‡§∂‡•â‡§™‡§ø‡§Ç‡§ó', history: '‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä' };
            
            activeTab.className = 'flex-1 py-4 px-4 text-center font-semibold text-blue-600 border-b-3 border-blue-600 bg-blue-50';
            activeTab.innerHTML = `${icons[section]} ${labels[section]}`;
        }

        // Store name editing
        function editStoreName() {
            document.getElementById('menuDropdown').classList.add('hidden');
            const newName = prompt('‡§∏‡•ç‡§ü‡•ã‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡§¶‡§≤‡•á‡§Ç:', storeName);
            if (newName && newName.trim()) {
                storeName = newName.trim();
                document.getElementById('storeName').textContent = storeName;
                localStorage.setItem('storeName', storeName);
                showToast('‚úÖ ‡§∏‡•ç‡§ü‡•ã‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
            }
        }

        // Barcode scanning
        function startScanning(section) {
            if (isScanning) return;
            
            const scannerDiv = document.getElementById(section + 'Scanner');
            const scanBtn = document.getElementById(section + 'ScanBtn');
            
            scannerDiv.classList.remove('hidden');
            scanBtn.disabled = true;
            isScanning = true;
            flashlightEnabled = false;
            
            html5QrCode = new Html5Qrcode(section + 'Reader');
            
            Html5Qrcode.getCameras().then(devices => {
                if (devices && devices.length) {
                    // Try to find back camera first
                    let cameraId = devices[0].id;
                    
                    // Look for back camera (environment facing)
                    const backCamera = devices.find(device => 
                        device.label.toLowerCase().includes('back') || 
                        device.label.toLowerCase().includes('rear') ||
                        device.label.toLowerCase().includes('environment')
                    );
                    
                    if (backCamera) {
                        cameraId = backCamera.id;
                    } else if (devices.length > 1) {
                        cameraId = devices[devices.length - 1].id;
                    }
                    
                    const config = {
                        fps: 20,
                        qrbox: { width: 180, height: 180 },
                        aspectRatio: 1.0,
                        disableFlip: false,
                        videoConstraints: {
                            facingMode: "environment",
                            focusMode: "continuous",
                            advanced: [
                                { focusMode: "continuous" },
                                { focusDistance: { min: 0.1, max: 10 } }
                            ]
                        }
                    };
                    
                    html5QrCode.start(
                        cameraId,
                        config,
                        (decodedText, decodedResult) => {
                            if (section === 'store') {
                                document.getElementById('productBarcode').value = decodedText;
                                fetchProductDetails(decodedText);
                                showToast('üì± ‡§¨‡§æ‡§∞‡§ï‡•ã‡§° ‡§∏‡•ç‡§ï‡•à‡§® ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
                            } else if (section === 'shopping') {
                                addToBill(decodedText);
                            }
                            stopScanning(section);
                        },
                        (errorMessage) => {
                            // Handle scan error silently
                        }
                    ).then(() => {
                        // Store current stream for flashlight
                        const video = document.querySelector(`#${section}Reader video`);
                        if (video && video.srcObject) {
                            currentStream = video.srcObject;
                        }
                    }).catch(err => {
                        console.log('Error starting scanner:', err);
                        // Fallback with basic constraints
                        html5QrCode.start(
                            { facingMode: "environment" },
                            { fps: 15, qrbox: { width: 180, height: 180 } },
                            (decodedText, decodedResult) => {
                                if (section === 'store') {
                                    document.getElementById('productBarcode').value = decodedText;
                                    fetchProductDetails(decodedText);
                                    showToast('üì± ‡§¨‡§æ‡§∞‡§ï‡•ã‡§° ‡§∏‡•ç‡§ï‡•à‡§® ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
                                } else if (section === 'shopping') {
                                    addToBill(decodedText);
                                }
                                stopScanning(section);
                            },
                            (errorMessage) => {}
                        ).catch(err2 => {
                            console.log('Fallback scanner failed:', err2);
                            stopScanning(section);
                            showToast('‚ùå ‡§ï‡•à‡§Æ‡§∞‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤ ‡§∏‡§ï‡§æ', 'error');
                        });
                    });
                }
            }).catch(err => {
                console.log('Error getting cameras:', err);
                showToast('‚ùå ‡§ï‡•à‡§Æ‡§∞‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤ ‡§∏‡§ï‡§æ', 'error');
                stopScanning(section);
            });
        }

        function stopScanning(section) {
            if (html5QrCode && isScanning) {
                html5QrCode.stop().then(() => {
                    html5QrCode.clear();
                }).catch(err => {
                    console.log('Error stopping scanner:', err);
                });
            }
            
            const scannerDiv = document.getElementById(section + 'Scanner');
            const scanBtn = document.getElementById(section + 'ScanBtn');
            const flashBtn = document.getElementById(section + 'FlashBtn');
            
            scannerDiv.classList.add('hidden');
            scanBtn.disabled = false;
            isScanning = false;
            flashlightEnabled = false;
            currentStream = null;
            
            if (flashBtn) {
                flashBtn.classList.remove('active');
                flashBtn.textContent = 'üí°';
            }
        }

        // Product management
        function addProduct() {
            const barcode = document.getElementById('productBarcode').value.trim();
            const name = document.getElementById('productName').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const details = document.getElementById('productDetails').value.trim();

            if (!name || !price) {
                showToast('‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§ï‡•Ä‡§Æ‡§§ ‡§°‡§æ‡§≤‡•á‡§Ç', 'error');
                return;
            }

            const productId = barcode || Date.now().toString();
            
            products[productId] = {
                id: productId,
                barcode: barcode,
                name: name,
                price: price,
                details: details,
                dateAdded: new Date().toLocaleString('hi-IN')
            };

            closeAddModal();
            displayProducts();
            showToast('‚úÖ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ!', 'success');
        }

        function displayProducts() {
            const productsList = document.getElementById('productsList');
            productsList.innerHTML = '';

            if (Object.keys(products).length === 0) {
                productsList.innerHTML = '<div class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">üì¶</div><p>‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p></div>';
                return;
            }

            Object.values(products).forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.className = 'bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-xl border border-gray-200 hover:shadow-md transition-all duration-300';
                productDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800 text-lg">${product.name}</h4>
                            <p class="text-green-600 font-bold text-xl">‚Çπ${product.price}</p>
                            ${product.barcode ? `<p class="text-xs text-gray-500 bg-gray-200 inline-block px-2 py-1 rounded mt-1">üî¢ ${product.barcode}</p>` : ''}
                            ${product.details ? `<p class="text-sm text-gray-600 mt-2">${product.details}</p>` : ''}
                        </div>
                        <div class="flex space-x-2 ml-3">
                            <button onclick="editProduct('${product.id}')" class="p-2 bg-blue-500 text-white rounded-lg text-sm font-semibold hover:bg-blue-600 transition-colors">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="deleteProduct('${product.id}')" class="p-2 bg-red-500 text-white rounded-lg text-sm font-semibold hover:bg-red-600 transition-colors">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
                productsList.appendChild(productDiv);
            });
        }

        function editProduct(productId) {
            const product = products[productId];
            if (!product) return;

            currentEditingProduct = productId;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductDetails').value = product.details || '';
            document.getElementById('editModal').classList.remove('hidden');
        }

        function updateProduct() {
            if (!currentEditingProduct) return;

            const name = document.getElementById('editProductName').value.trim();
            const price = parseFloat(document.getElementById('editProductPrice').value);
            const details = document.getElementById('editProductDetails').value.trim();

            if (!name || !price) {
                showToast('‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§ï‡•Ä‡§Æ‡§§ ‡§°‡§æ‡§≤‡•á‡§Ç', 'error');
                return;
            }

            products[currentEditingProduct].name = name;
            products[currentEditingProduct].price = price;
            products[currentEditingProduct].details = details;

            closeEditModal();
            displayProducts();
            showToast('‚úÖ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            currentEditingProduct = null;
        }

        function deleteProduct(productId) {
            if (confirm('üóëÔ∏è ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§ï‡•ã ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                delete products[productId];
                displayProducts();
                showToast('‚úÖ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
            }
        }

        // Shopping functionality
        function searchProducts(query) {
            const searchResults = document.getElementById('searchResults');
            
            if (!query.trim()) {
                searchResults.classList.add('hidden');
                return;
            }

            const results = Object.values(products).filter(product => 
                product.name.toLowerCase().includes(query.toLowerCase()) ||
                product.barcode === query
            );

            if (results.length === 0) {
                searchResults.innerHTML = '<div class="text-center py-4 text-gray-500"><div class="text-2xl mb-1">üîç</div><p>‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p></div>';
                searchResults.classList.remove('hidden');
                return;
            }

            searchResults.innerHTML = results.map(product => `
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-3 rounded-xl border border-blue-200 cursor-pointer hover:shadow-md transition-all duration-300" onclick="addToBill('${product.id}')">
                    <div class="font-semibold text-gray-800">${product.name}</div>
                    <div class="text-green-600 font-bold">‚Çπ${product.price}</div>
                </div>
            `).join('');
            
            searchResults.classList.remove('hidden');
        }

        function addToBill(productId) {
            const product = products[productId];
            if (!product) {
                showToast('‚ùå ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!', 'error');
                return;
            }

            const existingItem = billItems.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                billItems.push({
                    id: productId,
                    name: product.name,
                    price: product.price,
                    quantity: 1
                });
            }

            document.getElementById('searchProduct').value = '';
            document.getElementById('searchResults').classList.add('hidden');
            displayBillItems();
            updateTotal();
            showToast('‚úÖ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§¨‡§ø‡§≤ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ!', 'success');
        }

        function displayBillItems() {
            const billItemsDiv = document.getElementById('billItems');
            
            if (billItems.length === 0) {
                billItemsDiv.innerHTML = '<div class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">üõçÔ∏è</div><p>‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç</p></div>';
                return;
            }

            billItemsDiv.innerHTML = billItems.map((item, index) => `
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-xl border border-green-200">
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800">${item.name}</h4>
                            <p class="text-sm text-gray-600">‚Çπ${item.price} √ó ${item.quantity} = <span class="font-bold text-green-600">‚Çπ${(item.price * item.quantity).toFixed(2)}</span></p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateQuantity(${index}, -1)" class="w-8 h-8 bg-red-500 text-white rounded-full text-sm font-bold hover:bg-red-600 transition-colors">-</button>
                            <span class="w-8 text-center font-bold">${item.quantity}</span>
                            <button onclick="updateQuantity(${index}, 1)" class="w-8 h-8 bg-green-500 text-white rounded-full text-sm font-bold hover:bg-green-600 transition-colors">+</button>
                            <button onclick="removeFromBill(${index})" class="w-8 h-8 bg-gray-500 text-white rounded-full text-sm font-bold hover:bg-gray-600 transition-colors">√ó</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateQuantity(index, change) {
            billItems[index].quantity += change;
            if (billItems[index].quantity <= 0) {
                billItems.splice(index, 1);
            }
            displayBillItems();
            updateTotal();
        }

        function removeFromBill(index) {
            billItems.splice(index, 1);
            displayBillItems();
            updateTotal();
            showToast('‚úÖ ‡§Ü‡§á‡§ü‡§Æ ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!', 'success');
        }

        function updateTotal() {
            const total = billItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('totalAmount').textContent = `‚Çπ${total.toFixed(2)}`;
        }

        function clearBill() {
            if (billItems.length > 0 && confirm('üóëÔ∏è ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§¨‡§ø‡§≤ ‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                billItems = [];
                document.getElementById('customerName').value = '';
                displayBillItems();
                updateTotal();
                showToast('‚úÖ ‡§¨‡§ø‡§≤ ‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞ ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
            }
        }

        function saveBill() {
            if (billItems.length === 0) {
                showToast('‚ùå ‡§¨‡§ø‡§≤ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!', 'error');
                return;
            }

            const customerName = document.getElementById('customerName').value.trim();
            const bill = {
                id: Date.now(),
                date: new Date().toLocaleString('hi-IN'),
                customerName: customerName,
                items: [...billItems],
                total: billItems.reduce((sum, item) => sum + (item.price * item.quantity), 0)
            };

            billHistory.unshift(bill);
            billItems = [];
            document.getElementById('customerName').value = '';
            displayBillItems();
            updateTotal();
            displayBillHistory();
            showToast('‚úÖ ‡§¨‡§ø‡§≤ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
        }

        function printBill() {
            if (billItems.length === 0) {
                showToast('‚ùå ‡§¨‡§ø‡§≤ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!', 'error');
                return;
            }

            const customerName = document.getElementById('customerName').value.trim();
            const total = billItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Create canvas for image generation
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size (POS receipt size)
            canvas.width = 400;
            canvas.height = 600 + (billItems.length * 25) + (customerName ? 25 : 0);
            
            // White background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Set text properties
            ctx.fillStyle = '#000000';
            ctx.textAlign = 'center';
            
            let y = 40;
            
            // Store name
            ctx.font = 'bold 24px Arial';
            ctx.fillText(storeName, canvas.width / 2, y);
            y += 30;
            
            // Bill title
            ctx.font = '16px Arial';
            ctx.fillText('üßæ ‡§¨‡§ø‡§≤', canvas.width / 2, y);
            y += 25;
            
            // Date
            ctx.font = '12px Arial';
            ctx.fillText(new Date().toLocaleString('hi-IN'), canvas.width / 2, y);
            y += 30;
            
            // Customer name if provided
            if (customerName) {
                ctx.font = '14px Arial';
                ctx.fillText(`‡§ó‡•ç‡§∞‡§æ‡§π‡§ï: ${customerName}`, canvas.width / 2, y);
                y += 30;
            }
            
            // Line separator
            ctx.beginPath();
            ctx.moveTo(20, y);
            ctx.lineTo(canvas.width - 20, y);
            ctx.stroke();
            y += 20;
            
            // Table headers
            ctx.textAlign = 'left';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('‡§Ü‡§á‡§ü‡§Æ', 20, y);
            ctx.textAlign = 'center';
            ctx.fillText('‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ', canvas.width / 2, y);
            ctx.textAlign = 'right';
            ctx.fillText('‡§∞‡§æ‡§∂‡§ø', canvas.width - 20, y);
            y += 20;
            
            // Line separator
            ctx.beginPath();
            ctx.moveTo(20, y);
            ctx.lineTo(canvas.width - 20, y);
            ctx.stroke();
            y += 15;
            
            // Bill items
            ctx.font = '12px Arial';
            billItems.forEach(item => {
                ctx.textAlign = 'left';
                ctx.fillText(item.name, 20, y);
                ctx.textAlign = 'center';
                ctx.fillText(item.quantity.toString(), canvas.width / 2, y);
                ctx.textAlign = 'right';
                ctx.fillText(`‚Çπ${(item.price * item.quantity).toFixed(2)}`, canvas.width - 20, y);
                y += 25;
            });
            
            // Line separator
            y += 10;
            ctx.beginPath();
            ctx.moveTo(20, y);
            ctx.lineTo(canvas.width - 20, y);
            ctx.stroke();
            y += 25;
            
            // Total
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:', 20, y);
            ctx.textAlign = 'right';
            ctx.fillText(`‚Çπ${total.toFixed(2)}`, canvas.width - 20, y);
            y += 40;
            
            // Thank you message
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üôè ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!', canvas.width / 2, y);
            
            // Convert canvas to image and download
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bill_${Date.now()}.png`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('üì∏ ‡§¨‡§ø‡§≤ ‡§á‡§Æ‡•á‡§ú ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à!', 'success');
            });
        }

        // History functionality
        function displayBillHistory() {
            const historyDiv = document.getElementById('billHistory');
            
            if (billHistory.length === 0) {
                historyDiv.innerHTML = '<div class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">üìã</div><p>‡§ï‡•ã‡§à ‡§¨‡§ø‡§≤ ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç</p></div>';
                return;
            }

            historyDiv.innerHTML = billHistory.map(bill => `
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-200">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-bold text-gray-800">üßæ ‡§¨‡§ø‡§≤ #${bill.id}</h4>
                            <p class="text-sm text-gray-600">üìÖ ${bill.date}</p>
                            ${bill.customerName ? `<p class="text-sm text-blue-600">üë§ ${bill.customerName}</p>` : ''}
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-green-600 text-xl">‚Çπ${bill.total.toFixed(2)}</p>
                            <button onclick="printOldBill(${bill.id})" class="text-xs bg-blue-500 text-white px-3 py-1 rounded-lg mt-1 font-semibold hover:bg-blue-600 transition-colors">
                                üì∏ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°
                            </button>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 bg-white p-2 rounded-lg">
                        <strong>‡§Ü‡§á‡§ü‡§Æ‡•ç‡§∏:</strong> ${bill.items.map(item => `${item.name} (${item.quantity})`).join(', ')}
                    </div>
                </div>
            `).join('');
        }

        function printOldBill(billId) {
            const bill = billHistory.find(b => b.id === billId);
            if (!bill) return;

            // Create canvas for image generation
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size (POS receipt size)
            canvas.width = 400;
            canvas.height = 600 + (bill.items.length * 25) + (bill.customerName ? 25 : 0);
            
            // White background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Set text properties
            ctx.fillStyle = '#000000';
            ctx.textAlign = 'center';
            
            let y = 40;
            
            // Store name
            ctx.font = 'bold 24px Arial';
            ctx.fillText(storeName, canvas.width / 2, y);
            y += 30;
            
            // Bill title
            ctx.font = '16px Arial';
            ctx.fillText(`üßæ ‡§¨‡§ø‡§≤ #${bill.id}`, canvas.width / 2, y);
            y += 25;
            
            // Date
            ctx.font = '12px Arial';
            ctx.fillText(bill.date, canvas.width / 2, y);
            y += 30;
            
            // Customer name if provided
            if (bill.customerName) {
                ctx.font = '14px Arial';
                ctx.fillText(`‡§ó‡•ç‡§∞‡§æ‡§π‡§ï: ${bill.customerName}`, canvas.width / 2, y);
                y += 30;
            }
            
            // Line separator
            ctx.beginPath();
            ctx.moveTo(20, y);
            ctx.lineTo(canvas.width - 20, y);
            ctx.stroke();
            y += 20;
            
            // Table headers
            ctx.textAlign = 'left';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('‡§Ü‡§á‡§ü‡§Æ', 20, y);
            ctx.textAlign = 'center';
            ctx.fillText('‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ', canvas.width / 2, y);
            ctx.textAlign = 'right';
            ctx.fillText('‡§∞‡§æ‡§∂‡§ø', canvas.width - 20, y);
            y += 20;
            
            // Line separator
            ctx.beginPath();
            ctx.moveTo(20, y);
            ctx.lineTo(canvas.width - 20, y);
            ctx.stroke();
            y += 15;
            
            // Bill items
            ctx.font = '12px Arial';
            bill.items.forEach(item => {
                ctx.textAlign = 'left';
                ctx.fillText(item.name, 20, y);
                ctx.textAlign = 'center';
                ctx.fillText(item.quantity.toString(), canvas.width / 2, y);
                ctx.textAlign = 'right';
                ctx.fillText(`‚Çπ${(item.price * item.quantity).toFixed(2)}`, canvas.width - 20, y);
                y += 25;
            });
            
            // Line separator
            y += 10;
            ctx.beginPath();
            ctx.moveTo(20, y);
            ctx.lineTo(canvas.width - 20, y);
            ctx.stroke();
            y += 25;
            
            // Total
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:', 20, y);
            ctx.textAlign = 'right';
            ctx.fillText(`‚Çπ${bill.total.toFixed(2)}`, canvas.width - 20, y);
            y += 40;
            
            // Thank you message
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üôè ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!', canvas.width / 2, y);
            
            // Convert canvas to image and download
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bill_${bill.id}.png`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('üì∏ ‡§¨‡§ø‡§≤ ‡§á‡§Æ‡•á‡§ú ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à!', 'success');
            });
        }

        // Data import/export
        function exportData() {
            document.getElementById('menuDropdown').classList.add('hidden');
            const data = {
                storeName: storeName,
                products: products,
                billHistory: billHistory,
                currentTheme: currentTheme,
                notes: notes,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `${storeName}_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('‚úÖ ‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('üì• ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§°‡•á‡§ü‡§æ ‡§á‡§Æ‡•ç‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? ‡§Ø‡§π ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§°‡•á‡§ü‡§æ ‡§ï‡•ã ‡§¨‡§¶‡§≤ ‡§¶‡•á‡§ó‡§æ‡•§')) {
                        if (data.storeName) storeName = data.storeName;
                        if (data.products) products = data.products;
                        if (data.billHistory) billHistory = data.billHistory;
                        if (data.currentTheme) {
                            currentTheme = data.currentTheme;
                            document.body.className = `bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen theme-${currentTheme}`;
                        }
                        if (data.notes) notes = data.notes;
                        
                        document.getElementById('storeName').textContent = storeName;
                        displayProducts();
                        displayBillHistory();
                        
                        showToast('‚úÖ ‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§á‡§Æ‡•ç‡§™‡•ã‡§∞‡•ç‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
                    }
                } catch (error) {
                    showToast('‚ùå ‡§ó‡§≤‡§§ ‡§´‡§æ‡§á‡§≤ ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü!', 'error');
                }
            };
            reader.readAsText(file);
            
            // Clear the input
            event.target.value = '';
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'972f76dd54901432',t:'MTc1NTgzNTIzOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
